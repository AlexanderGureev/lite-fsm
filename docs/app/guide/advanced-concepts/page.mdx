# –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã —Ä–∞–±–æ—Ç—ã —Å `lite-fsm` –∏ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–∞–¥–∞—á.

## –û–±–∑–æ—Ä —Ä–∞–∑–¥–µ–ª–æ–≤

- [–†–∞–±–æ—Ç–∞ —Å TypeScript](/guide/advanced-concepts/work-with-typescript) - –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏—é —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π API.

## –¢–∏–ø–∏–∑–∞—Ü–∏—è —Å TypeScript

`lite-fsm` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±–æ–≥–∞—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TypeScript –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –í [–æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä–∞–∑–¥–µ–ª–µ](/guide/advanced-concepts/work-with-typescript) –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ö—É–∫–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤–∞—à–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤.

–í–∫—Ä–∞—Ç—Ü–µ, —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π API
2. –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç–∏–ø—ã –≤—Å–µ—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º –º–µ—Å—Ç–µ
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏
4. –ò–º–µ—Ç—å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ IDE –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π, —Å–æ–±—ã—Ç–∏–π –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

## –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å Immer

–î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π `lite-fsm` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π Immer, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å "–º—É—Ç–∏—Ä—É—é—â–∏–π" –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```ts
import { createMachine } from "lite-fsm";
import { produce } from "immer";

const todosMachine = createMachine({
  config: {
    IDLE: {
      ADD_TODO: null,
      TOGGLE_TODO: null,
      DELETE_TODO: null,
      SET_FILTER: null,
    },
  },
  initialState: "IDLE",
  initialContext: {
    todos: [],
    filter: "all",
  },
  reducer: (state, action, { nextState }) => {
    const { state: currentState, context } = state;

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º Immer –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const nextContext = produce(context, (draft) => {
      switch (action.type) {
        case "ADD_TODO":
          draft.todos.push({
            id: Date.now(),
            text: action.payload.text,
            completed: false,
          });
          break;

        case "TOGGLE_TODO":
          const todo = draft.todos.find((t) => t.id === action.payload.id);
          if (todo) {
            todo.completed = !todo.completed;
          }
          break;

        case "DELETE_TODO":
          const index = draft.todos.findIndex((t) => t.id === action.payload.id);
          if (index !== -1) {
            draft.todos.splice(index, 1);
          }
          break;

        case "SET_FILTER":
          draft.filter = action.payload.filter;
          break;
      }
    });

    return {
      state: nextState,
      context: nextContext,
    };
  },
});
```

## –≠—Ñ—Ñ–µ–∫—Ç—ã —Å –æ—Ç–º–µ–Ω–æ–π

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ –∏–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏, –≥–¥–µ –Ω–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–º–µ–Ω—è—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ `createEffect` —Å —Ç–∏–ø–æ–º `latest`:

```ts
import { createMachine, createEffect } from "lite-fsm";

// –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–º–µ–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –≤—ã–∑–æ–≤–æ–≤
const searchEffect = createEffect({
  type: "latest", // –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–æ –∫–æ–Ω—Ü–∞
  effect: async ({ transition, services }, { query }) => {
    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
    const results = await services.api.search(query);
    // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
    transition({ type: "SEARCH_SUCCESS", payload: { results } });
  },
});

const searchMachine = createMachine({
  config: {
    IDLE: {
      SEARCH: "SEARCHING",
    },
    SEARCHING: {
      SEARCH_SUCCESS: "RESULTS",
      SEARCH_ERROR: "ERROR",
      SEARCH: "SEARCHING", // –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫
    },
    RESULTS: {
      SEARCH: "SEARCHING",
      CLEAR: "IDLE",
    },
    ERROR: {
      SEARCH: "SEARCHING",
      CLEAR: "IDLE",
    },
  },
  initialState: "IDLE",
  initialContext: {
    query: "",
    results: [],
    error: null,
  },
  effects: {
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å –æ—Ç–º–µ–Ω–æ–π
    SEARCHING: ({ services, transition }, event) => {
      return searchEffect({ services, transition }, event.payload || {});
    },
  },
});
```

## –î–µ–±–∞–≥–≥–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–∞—à–∏–Ω —Å–æ—Å—Ç–æ—è–Ω–∏–π –ø–æ–ª–µ–∑–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```ts
import { MachineManager } from "lite-fsm";

// –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
const manager = MachineManager({
  /* –∞–≤—Ç–æ–º–∞—Ç—ã... */
});

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
manager.onTransition((prevState, nextState, action) => {
  console.group("üîÑ State Transition");
  console.log("Action:", action);
  console.log("Previous State:", prevState);
  console.log("Next State:", nextState);
  console.log("Changed:", JSON.stringify(getChanges(prevState, nextState)));
  console.groupEnd();
});

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
function getChanges(prevState, nextState) {
  const changes = {};

  // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –º–∞—à–∏–Ω—ã
  Object.keys(nextState).forEach((machineName) => {
    const prev = prevState[machineName];
    const next = nextState[machineName];

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
    if (prev.state !== next.state) {
      changes[machineName] = changes[machineName] || {};
      changes[machineName].state = {
        from: prev.state,
        to: next.state,
      };
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    const contextChanges = {};
    let hasContextChanges = false;

    Object.keys(next.context).forEach((key) => {
      if (JSON.stringify(prev.context[key]) !== JSON.stringify(next.context[key])) {
        contextChanges[key] = {
          from: prev.context[key],
          to: next.context[key],
        };
        hasContextChanges = true;
      }
    });

    if (hasContextChanges) {
      changes[machineName] = changes[machineName] || {};
      changes[machineName].context = contextChanges;
    }
  });

  return changes;
}
```

## –°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–∂–Ω—ã—Ö –º–∞—à–∏–Ω

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–æ–ª–µ–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `createConfig` –¥–ª—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```ts
import { createMachine, createConfig } from "lite-fsm";

// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
const workflowConfig = createConfig({
  DRAFT: {
    SUBMIT: "REVIEW",
    SAVE: null,
    DISCARD: "CANCELLED",
  },
  REVIEW: {
    APPROVE: "APPROVED",
    REJECT: "REJECTED",
    REQUEST_CHANGES: "CHANGES_REQUESTED",
  },
  CHANGES_REQUESTED: {
    SUBMIT: "REVIEW",
    DISCARD: "CANCELLED",
  },
  APPROVED: {
    PUBLISH: "PUBLISHED",
    REVERT: "DRAFT",
  },
  REJECTED: {
    REVERT: "DRAFT",
    DISCARD: "CANCELLED",
  },
  PUBLISHED: {
    ARCHIVE: "ARCHIVED",
    UNPUBLISH: "DRAFT",
  },
  CANCELLED: {
    RESTORE: "DRAFT",
  },
  ARCHIVED: {
    RESTORE: "DRAFT",
  },
});

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞—à–∏–Ω—ã
const workflowMachine = createMachine({
  config: workflowConfig,
  initialState: "DRAFT",
  initialContext: {
    id: null,
    content: null,
    comments: [],
    lastModified: null,
    author: null,
  },
  // ...
});
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ `lite-fsm` –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∏ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω–µ—á–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤. –ö–æ–º–±–∏–Ω–∏—Ä—É—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –º–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –Ω–∞–¥–µ–∂–Ω—ã–µ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —á–µ—Ç–∫–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.
